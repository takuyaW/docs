コレクション
============

*コレクション* management can be done by using the following functions
and properties.

<div class="admonition note">

バックエンド API にアクセスする場合には、`jQuery`
の読み込み、および、ホワイトリストへの `cloud.monaca.mobi` の登録 ( 各
OS の設定ファイル上に )
を行います。詳細は、Android の場合はこちら &lt;access\_origin\_android&gt;
または iOS の場合はこちら &lt;access\_origin&gt; をご確認ください。

</div>

  メソッド/プロパティー 解説                                               
  ------------------------------------------------------------------------ -------------------------------------------------------------
  monaca.cloud.コレクション()&lt;c.コレクション&gt; コレクション           オブジェクトを取得します。
  monaca.cloud.コレクション.find()&lt;c.find&gt; すべて                    のユーザーのデータをコレクションから取得します。
  monaca.cloud.コレクション.findMine()&lt;c.findMine&gt; ユーザ            ーのデータをコレクションから取得します。
  monaca.cloud.コレクション.findOne()&lt;c.findOne&gt; 指定し              たアイテムをコレクションから 1 つ取得します。
  monaca.cloud.コレクション.findOneMine()&lt;c.findOneMine&gt; ユーザ      ーのアイテムをコレクションから 1 つ取得します。
  monaca.cloud.コレクション.insert()&lt;c.insert&gt; コレク                ションにデータを挿入します。
  monaca.cloud.コレクション.updatePermission()&lt;c.updatePer&gt; コレク   ション アイテムのパーミッション ( 権限 ) を一括更新します。

コレクション() - Retrieving a コレクション
------------------------------------------

指定した名前を使用して、 *コレクション*
オブジェクトを取得します。コレクションは、自動的には作成されないため、
あらかじめ、IDE 上で手動で作成しておきます。

monaca.cloud.コレクション(collectionName: string) : Object

パラメーター

:   ------------------ ------------------------------
      `collectionName`   コレクション名を指定します。
      ------------------ ------------------------------

戻り値

:   --------------------------- --
      コレクション オブジェクト   
      --------------------------- --

例

:   `\"diary\"` コレクションの取得方法を記します。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary"); // returns コレクション object
    ```

コレクション.find()
-------------------

すべてのユーザーのデータをコレクションから取得します。.

コレクション.find(criteria: Criteria or String, \[orderBy: String or Array\], \[options: Object\]): \$.Promise

パラメーター

:   ------------ ------------------------------------------------------------------------------------------------------------------------------
      `criteria`   criteria または 文字列
      `orderBy`    "field\_name ASC|DESC" 。並べ替え条件を複数指定する場合には、配列を使用します。例 ： \["title ASC", "author ASC"\]
      `options`    利用可能なオプションを、次に記します。
                   - `propertyNames` : 検索対象のユーザーのプロパティーを指定します。指定がない場合、ユーザーのすべてのプロパティーを返します。
                   - `limit` : 結果の件数の上限です。
                   - `page` : 指定したページ以降から、結果を取得します。
      ------------ ------------------------------------------------------------------------------------------------------------------------------

Result パラメーター of done() Callback

:   -------------- --------------------------- ----
      `totalItems`   数値 アイテム               数
      `items`        Array of コレクションItem   
      -------------- --------------------------- ----

戻り値

:   ------------------------------------- ----------------------------------------------------------------
      [\$.Promise](../other) オブジェクト   結果の処理には、 `done()`、`fail()`、`always()` を使用します。
      ------------------------------------- ----------------------------------------------------------------

エラーコード

:   エラーが発生すると、 error オブジェクトを返します。

      ---------- --------------------------
      `-32602`   不正なパラメーターです。
      ---------- --------------------------

例

:   次の例では、 `diary` コレクション内で検索を行い、 `Criteria`
    に一致したアイテムを、 `\"_createdAt\"` プロパティー順 ( 降順 )
    でソートして返します。返されるアイテムは、 `\"title\"` と `\"body\"`
    の 2 つのプロパティーを保持しています。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary");
    var Criteria = monaca.cloud.Criteria('title == "Monaca"');
    Diary.find(Criteria, "_createdAt DESC", {propertyNames: ["title", "body"], limit: 5})
    .done(function(result)
    {
       console.log('Total items found: ' + result.totalItems);
       console.log('The body of the first item: ' + result.items[0].body);
    })
    .fail(function(err)
    {
       console.log("Err#" + err.code +": " + err.message);
    });
    ```

    または、criteria に文字列を指定して、渡すこともできます。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary");
    Diary.find('title == "Monaca"', "", {propertyNames: ["title", "body"], limit: 5})
    .done(function(result)
    {
       console.log('Total items found: ' + result.totalItems);
       console.log('The body of the first item: ' + result.items[0].body);
    })
    .fail(function(err)
    {
       console.log("Err#" + err.code +": " + err.message);
    });
    ```

コレクション.findMine() - ユーザーのデータをコレクションから取得します。
------------------------------------------------------------------------

ユーザーのデータを、コレクションから取得します。

コレクション.findMine(criteria: Criteria or String, \[orderBy: String or Array\], \[options: Object\]): \$.Promise

パラメーター

:   ------------ ------------------------------------------------------------------------------------------------------------------------------
      `criteria`   criteria または 文字列
      `orderBy`    "field\_name ASC|DESC" 。複数の並べ替え条件を指定する場合、配列を使用します。例： \["title ASC", "author ASC"\]
      `options`    利用可能なオプションを、次に記します。
                   - `propertyNames` : 検索対象のユーザーのプロパティーを指定します。指定がない場合、ユーザーのすべてのプロパティーを返します。
                   - `limit` : 結果の件数の上限です。
                   - `page` : 指定したページ以降から、結果を取得します。
      ------------ ------------------------------------------------------------------------------------------------------------------------------

Result パラメーター of done() Callback

:   -------------- --------------------------- ----
      `totalItems`   数値 アイテム               数
      `items`        Array of コレクションItem   
      -------------- --------------------------- ----

戻り値

:   ------------------------------------- ----------------------------------------------------------------
      [\$.Promise](../other) オブジェクト   結果の処理には、 `done()`、`fail()`、`always()` を使用します。
      ------------------------------------- ----------------------------------------------------------------

エラーコード

:   エラーが発生すると、 error オブジェクトを返します。

      ---------- --------------------------
      `-32602`   不正なパラメーターです。
      ---------- --------------------------

例 :

:   次の例では、 `diary` コレクション内で検索を行い、 `nickname` が
    `my nickname` に一致したアイテムを、 `\"_createdAt\"` プロパティー順
    ( 降順 ) でソートして返します。返されるアイテムは、 `\"title\"` と
    `\"body\"` の 2 つのプロパティーを保持しています。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary");
    Diary.findMine('nickname == "my nickname"', "", {propertyNames: ["title", "body"], limit: 5})
    .done(function(result)
    {
       console.log('Total items found: ' + result.totalItems);
       console.log('The body of the first item: ' + result.items[0].body);
    })
    .fail(function(err)
    {
       console.log("Err#" + err.code +": " + err.message);
    });
    ```

コレクション.findOne() - Fetch an item
--------------------------------------

指定したアイテムを、コレクションから 1
つ取得します。複数のアイテムが条件に合う場合には、最初のアイテムを返します。

コレクション.findOne(criteria: Criteria or String, \[orderBy: String or Array\], \[options: Object\]): \$.Promise

パラメーター

:   ------------ ------------------------------------------------------------------------------------------------------------------------------
      `criteria`   criteria オブジェクト または 文字列
      `orderBy`    "field\_name ASC|DESC" 。並べ替え条件を複数指定する場合には、配列を使用します。例 ： \["title ASC", "author ASC"\]
      `options`    利用可能なオプション:
                   - `propertyNames` : 検索対象のユーザーのプロパティーを指定します。指定がない場合、ユーザーのすべてのプロパティーを返します。
      ------------ ------------------------------------------------------------------------------------------------------------------------------

Result パラメーター of done() Callback

:   -------- --------------------------------------------- --
      `item`   A コレクションItem (or null when no result)   
      -------- --------------------------------------------- --

戻り値

:   ------------------------------------- ----------------------------------------------------------------
      [\$.Promise](../other) オブジェクト   結果の処理には、 `done()`、`fail()`、`always()` を使用します。
      ------------------------------------- ----------------------------------------------------------------

エラーコード

:   エラーが発生すると、 error オブジェクトを返します。

      ---------- --------------------------
      `-32602`   不正なパラメーターです。
      ---------- --------------------------

例

:   次の例では、 `diary` コレクション内で検索を行い、Criteria
    に一致したアイテムを、 `\"_createdAt\"` プロパティー順 ( 降順 )
    にソートして返します。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary");
    Diary.findOne('title == "Monaca"', "_createdAt DESC")
    .done(function(result)
    {
       console.log('The body of the item: ' + result.body);
    })
    .fail(function(err)
    {
       console.log("Err#" + err.code +": " + err.message);
    });
    ```

コレクション.findOneMine() - Fetch an item of the current user
--------------------------------------------------------------

ユーザーのアイテムを、コレクションから 1
つ取得します。複数のアイテムが条件に合う場合には、最初のアイテムを返します。

コレクション.findOneMine(criteria: Criteria or String, \[orderBy: String or Array\], \[options: Object\]): \$.Promise

パラメーター

:   ------------ --------------------------------------------------------------------------------------------------------------------
      `criteria`   criteria または 文字列
      `orderBy`    "field\_name ASC|DESC" 。並べ替え条件を複数指定する場合には、配列を使用します。例 ： \["title ASC", "author ASC"\]
      `options`    利用可能なオプション:
                   - `propertyNames`: 取得するデータサイズを制限するため、フィルターをかけます。
      ------------ --------------------------------------------------------------------------------------------------------------------

Result パラメーター of done() Callback

:   -------- --------------------------------------------- --
      `item`   A コレクションItem (or null when no result)   
      -------- --------------------------------------------- --

戻り値

:   ------------------------------------- ----------------------------------------------------------------
      [\$.Promise](../other) オブジェクト   結果の処理には、 `done()`、`fail()`、`always()` を使用します。
      ------------------------------------- ----------------------------------------------------------------

エラーコード

:   エラーが発生すると、 error オブジェクトを返します。

      ---------- --------------------------
      `-32602`   不正なパラメーターです。
      ---------- --------------------------

例

:   次の例では、 `diary` コレクション内で検索を行い、Criteria
    に一致したアイテムを、 `\"_createdAt\"` プロパティー順 ( 降順 )
    にソートして返します。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary");
    Diary.findOneMine('title == "Monaca"', "_createdAt DESC")
    .done(function(result)
    {
       console.log('The body of the item: ' + result.body);
    })
    .fail(function(err)
    {
       console.log("Err#" + err.code +": " + err.message);
    });
    ```

コレクション.insert() - Inserting an Item
-----------------------------------------

Insert an item into the *コレクション*.

コレクション.insert(item: Object, \[permission: Object\]) : \$.Promise

パーミッション ( 権限 )
の設定に関わらず、ユーザーの所有者には、読み取りと書き込み権限が与えられています。

パラメーター

:   -------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      `item`         新規アイテムに関して、ユーザーが定義したデータ
      `permission`   アイテムにパーミッションを設定するときに使用するオブジェクト。オブジェクトに設定する Key は、 `“public”` ( すべてのユーザーが対象 ) または ユーザーの Oid&lt;u.\_oid&gt; になります。また、オブジェクトに設定する Value は、 `“r”` ( 読み取り許可 ) 、 `“w”` ( 書き込み許可 ) 、 `“rw”` ( 読み取りと書き込み許可 ) 、 `“”` ( すべて不許可 ) のいずれかとなります。例 : { “public”: 'rw', “oidOfUserA”: 'r', “oidOfUserB”: 'rw' } 。permission は、Key と Value の組み合わせで設定します。
      -------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Result パラメーター of done() Callback

:   --------- --------------------------- --
      `items`   Array of コレクションItem   
      --------- --------------------------- --

必須

:   -------- ------------------------------------------------------------------------------------------------------------
      `item`   Key 名には、 \[a-zA-Z0-9\] を使用して、 \[a-zA-Z\] から始まる必要がります。データサイズは、500 KB 内です。
      -------- ------------------------------------------------------------------------------------------------------------

戻り値

:   ------------------------------------- ----------------------------------------------------------------
      [\$.Promise](../other) オブジェクト   結果の処理には、 `done()`、`fail()`、`always()` を使用します。
      ------------------------------------- ----------------------------------------------------------------

エラーコード

:   エラーが発生すると、 error オブジェクトを返します。

      ---------- -----------------------------------------------------------------------------
      `-32602`   不正なパラメーターです。
      `-14`      パーミッションがありません ( アプリからのデータ挿入が制限されている場合 )。
      ---------- -----------------------------------------------------------------------------

例

:   次の例では、 `title` 、 `body` 、 `_createdAt` の 3
    つのフィールドを持つアイテムを、 `\"diary\"`
    コレクションに挿入します。挿入後、
    `x00000000-xxxx-xxxx-xxxx-xxxxxxxxxxxx` ( id )
    を所持するユーザーに対して、このアイテムへの読み取り専用のパーミッションを与えます。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary");
    var friendUserOid = "x00000000-xxxx-xxxx-xxxx-xxxxxxxxxxxx";
    var permission = {};
    permission[friendUserOid] = "r";

    Diary.insert({title: 'Any title', body: 'Hello World'}, permission)
    .done(function(result)
    {
       console.log("Inserted!");
    })
    .fail(function(err)
    {
       console.log("Err#" + err.code +": " + err.message);
    });
    ```

コレクション.updatePermission() - コレクション アイテムのパーミッション ( 権限 ) を一括更新します。
---------------------------------------------------------------------------------------------------

コレクションアイテムのパーミッション ( 権限 ) を、一括更新します。

コレクション.updatePermission(criteria: Criteria or String, permission: Object, \[options: Object\]) : \$.Promise

パラメーター

:   -------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      `criteria`     criteria または 文字列
      `permission`   パーミッションを指定するオブジェクト。`rw` は読み取りと書き込み、 `r` は読み取り専用、 `w` は書き込み専用、空の文字列は 「 パーミッションなし 」 となります。利用可能なオプションとして、 `forceOverwrite`: boolean があります。こちらのオプションを使用して、現在のパーミッションの上書きを行うか否か決定します ( デフォルト : `false` ) 。
      -------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Result パラメーター of done() Callback

:   -------------- ------------- --------------
      `numUpdates`   数値 更新し   たアイテム数
      -------------- ------------- --------------

戻り値

:   ------------------------------------- ----------------------------------------------------------------
      [\$.Promise](../other) オブジェクト   結果の処理には、 `done()`、`fail()`、`always()` を使用します。
      ------------------------------------- ----------------------------------------------------------------

エラーコード

:   エラーが発生すると、 error オブジェクトを返します。

      ---------- -----------------------------------------------------------------------------
      `-32602`   不正なパラメーターです。
      `-14`      パーミッションがありません ( アプリからのデータ挿入が制限されている場合 )。
      ---------- -----------------------------------------------------------------------------

例

:   次の例では、読み取りと書き込みのパーミッションを `User X`
    へ、読み取りのみのパーミッションを `User Y` へ与えます。

    ``` {.sourceCode .javascript}
    var Diary = monaca.cloud.コレクション("diary");

    var oids =
    {
       userX: "x00000000-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
       userY: "x00000000-yyyy-yyyy-yyyy-yyyyyyyyyyyy"
    };

    var newPermission = {};
    newPermission[oids.userX] = "rw";
    newPermission[oids.userY] = "r";

    Diary.updatePermission('group_id == 1', newPermission)
    .done(function(result)
    {
       console.log(result.numUpdates + " items updated");
    })
    .fail(function(err)
    {
       console.log("Err#" + err.code +": " + err.message);
    });
    ```


